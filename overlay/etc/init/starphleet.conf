description "Starphleet Main, emits the pulse signal"

setuid admiral
emits starphleet_pulse

stop on stopping docker

respawn

pre-start script
  #let's get access to docker without sudo all the time, thanks
  sudo chmod 0777 /var/run/docker.sock
end script

script
  while [ 1 ]
  do
    echo `date +"%c"` PULSE
    if [ -s "/var/starphleet/.headquarters" ]; then
      sudo initctl emit starphleet_pulse
    else
      echo $(tput setaf 1; tput bold)
      echo "**"
      echo You have no headquarters, add one with
      echo headquarters giturl
      echo "**"
      echo $(tput sgr0)
    fi
    sleep 5
  done
end script

post-stop script
  #lose all state on stop, makes testing smoother and less to go wrong
  sudo rm -rf /var/starphleet/current_containers/*
  sudo rm -rf /var/starphleet/current_orders/*
  sudo rm -rf /var/starphleet/headquarters
end script
