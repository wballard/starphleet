#! /usr/bin/env bash
## headquarters 0.1.0
### Usage:
###    headquarters <url>
### --help
###
### Set the headquarters <url>. This is where the phleet will look for
### orders.
### The <url> can include a #branch on the end which will refer to that specific
### branch rather than default master.
help=$(grep "^### " "$0" | cut -c 5-)
version=$(grep "^## "  "$0" | cut -c 4-)
DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
eval "$(${DIR}/docopts -h "$help" -V "$version" : "$@")"
source "${DIR}/tools"
set -e

cat <<EOF > /var/starphleet/.headquarters
export HEADQUARTERS_REMOTE="${url}"
export HEADQUARTERS_LOCAL="/var/starphleet/headquarters"
export CURRENT_ORDERS="/var/starphleet/current_orders"
export NGINX_CONF="/var/starphleet/nginx"
export ADMIRAL="admiral"
export ADMIRAL_HOME="/home/admiral"
if [ -s /var/starphleet/headquarters/.starphleet ]; then
  source /var/starphleet/headquarters/.starphleet
fi

EOF
cat "${DIR}/tools" >> /var/starphleet/.headquarters

info Headquarters is ${url}
