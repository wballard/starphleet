#!/usr/bin/env starphleet-launcher
### Usage:
###    starphleet-s3-get-container <containerName>
###
### Fuzzy match and make attaching to instances easier
run_as_root_or_die

# Make sure they pass 'something' to search for
[ -z "${containerName}" ] && echo Please pass the name of a container && exit 1

# These envs are required for the AWS command line
export AWS_ACCESS_KEY_ID="${S3_STORAGE_AWS_ACCESS_KEY_ID}"
export AWS_SECRET_ACCESS_KEY="${S3_STORAGE_AWS_SECRET_ACCESS_KEY}"

# Sets AWS_COMMAND_PATH (and installs a newer version of aws command if needed)
get_updated_aws_command

S3_PATH_FOR_CONTAINER_STORAGE="s3://${S3_STORAGE_BUCKET_PATH}"
# Specify region here because orders files can unset variables...
# I also want to be explicit, as any parameter in the CLI will override
# any other profiles or environment variables.
"${AWS_COMMAND_PATH}" s3 cp --region "${S3_STORAGE_BUCKET_REGION}" "${S3_PATH_FOR_CONTAINER_STORAGE}/${containerName}.tar.gz" . \
  || exit ${EXIT_CODE_FOR_FAILED_S3_DOWNLOADS}
