#!/usr/bin/env bash
DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

## run-script 0.1.0
### Usage:
###    run-script <starphleet_file>
### --help
###
### Generate the 'run' script from a Starphleet file.
help=$(grep "^### " "$0" | cut -c 5-)
version=$(grep "^## "  "$0" | cut -c 4-)
eval "$(${DIR}/docopts -h "$help" -V "$version" : "$@")"

EXTRACTOR='
  /start script/ { in_it = 1; next;}
  /end script/ {in_it = 0;}
  {if (in_it) print $0;}
'
cat << "EOF"
  export HOME=/app
  [[ -f "/app/.env" ]] && . "/app/.env"
  for file in /app/.profile.d/*; do source $file; done
  hash -r
  #need to be in the directory for the source
  cd /app
EOF
cat "${starphleet_file}" | awk "${EXTRACTOR}" -
